<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°„ç¥çµŒãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            background-color: rgb(0, 0, 0); /* èƒŒæ™¯ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§çœŸã£é»’ã« */
            color: #ecf0f1;
            overflow: hidden;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            transition: background-color 0.1s; /* èƒŒæ™¯è‰²å¤‰æ›´ã‚’å°‘ã—æ»‘ã‚‰ã‹ã« */
        }

        /* æ–‡å­—ãŒè¦‹ãˆã«ãããªã‚‰ãªã„ã‚ˆã†ã«å½±ã‚’ã¤ã‘ã‚‹ */
        h1, p, h2, label, li {
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* --- ä¸Šéƒ¨ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ --- */
        #top-ui {
            text-align: center;
            position: absolute;
            top: 5%;
            width: 100%;
            z-index: 10;
            pointer-events: none;
        }

        h1 { margin: 0 0 10px 0; font-size: 2rem; }
        p { font-size: 1.2rem; margin: 0; height: 1.5em; font-weight: bold; }

        /* --- ä¸­å¤®ã‚¨ãƒªã‚¢ï¼ˆãƒœã‚¿ãƒ³ã¨çµæœï¼‰ --- */
        #center-ui {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
            pointer-events: none; /* ã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã¯è²«é€šã•ã›ã‚‹ */
        }

        button {
            pointer-events: auto; /* ãƒœã‚¿ãƒ³ã¯æŠ¼ã›ã‚‹ã‚ˆã†ã« */
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            color: #fff;
            background-color: #3498db;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
            box-shadow: 0 6px 12px rgba(0,0,0,0.5);
        }
        button:hover { background-color: #2980b9; transform: scale(1.05); }

        #result { font-size: 1.5rem; display: none; margin-bottom: 20px;}
        .score { font-size: 3.5rem; font-weight: bold; color: #f1c40f; text-shadow: 0 4px 8px rgba(0,0,0,0.9); }

        /* --- ğŸŒŸ ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒœã‚¿ãƒ³ --- */
        #hamburger-btn {
            position: absolute;
            top: 15px;
            left: 20px;
            font-size: 2rem;
            cursor: pointer;
            z-index: 20;
            pointer-events: auto;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* --- å·¦å´ã®è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆã‚¹ãƒ©ã‚¤ãƒ‰å¼ï¼‰ --- */
        #settings-container {
            position: absolute;
            left: -300px; /* åˆæœŸçŠ¶æ…‹ã¯ç”»é¢å¤–ã«éš ã™ */
            top: 0;
            height: 100vh;
            width: 250px;
            background-color: rgba(0, 0, 0, 0.85);
            padding: 20px;
            box-sizing: border-box;
            z-index: 15;
            pointer-events: auto; 
            cursor: default;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* æ»‘ã‚‰ã‹ã«ã‚¹ãƒ©ã‚¤ãƒ‰ */
            overflow-y: auto; /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé•·ã„å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            border-right: 1px solid #34495e;
        }
        
        /* JavaScriptã§ã“ã®ã‚¯ãƒ©ã‚¹ã‚’ã¤ã‘ã‚‹ã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ã */
        #settings-container.open { left: 0; }

        #close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2rem;
            cursor: pointer;
            line-height: 1;
        }

        #settings-container h2 {
            margin: 40px 0 15px 0;
            font-size: 1.2rem;
            border-bottom: 1px solid #7f8c8d;
            padding-bottom: 5px;
            text-align: center;
        }

        .setting-group { margin-bottom: 25px; }
        .setting-group label { display: block; margin-bottom: 5px; font-size: 0.9rem; }
        
        input[type="range"] { width: 100%; cursor: pointer; margin-bottom: 10px; }

        .color-preview {
            width: 100%; height: 30px;
            border-radius: 4px;
            border: 2px solid #fff;
            box-sizing: border-box; margin-top: 5px;
        }

        /* --- å³å´ã®å±¥æ­´ãƒ¡ãƒ‹ãƒ¥ãƒ¼ --- */
        #history-container {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 8px;
            z-index: 10;
            pointer-events: none;
            width: 150px;
        }

        #history-container h2 { margin: 0 0 10px 0; font-size: 1.2rem; border-bottom: 1px solid #7f8c8d; padding-bottom: 5px; text-align: center; }
        #history-list { list-style: none; padding: 0; margin: 0; font-size: 1.1rem; line-height: 1.8; font-family: monospace; }
        .warning { color: #e74c3c !important; }

        /* --- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ä¸¸ --- */
        #target-circle {
            width: 80vmin;
            height: 80vmin;
            background-color: rgb(241, 196, 15);
            border-radius: 50%;
            position: absolute;
            top: 50%; /* ç”»é¢ã®ãƒ‰çœŸã‚“ä¸­ */
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: none;
            z-index: 5;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="hamburger-btn">â˜°</div>

    <div id="top-ui">
        <h1>åå°„ç¥çµŒãƒ†ã‚¹ãƒˆ</h1>
        <p id="message">ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦æº–å‚™</p>
    </div>

    <div id="center-ui">
        <div id="result"></div>
        <button id="start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>

    <div id="settings-container">
        <div id="close-btn">Ã—</div>
        <h2>ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</h2>
        
        <div class="setting-group">
            <label>ä¸¸ã®ã‚µã‚¤ã‚º: <span id="size-label">80</span>%</label>
            <input type="range" id="size-slider" min="10" max="100" value="80">
        </div>

        <div class="setting-group">
            <label>ä¸¸ã®è‰² (RGB)</label>
            <label style="color:#ff7675;">R: <span id="r-label">241</span></label>
            <input type="range" id="r-slider" min="0" max="255" value="241">
            <label style="color:#55efc4;">G: <span id="g-label">196</span></label>
            <input type="range" id="g-slider" min="0" max="255" value="196">
            <label style="color:#74b9ff;">B: <span id="b-label">15</span></label>
            <input type="range" id="b-slider" min="0" max="255" value="15">
            <div id="color-preview" class="color-preview" style="background-color: rgb(241, 196, 15);"></div>
        </div>

        <div class="setting-group">
            <label>èƒŒæ™¯ã®è‰² (RGB)</label>
            <label style="color:#ff7675;">R: <span id="bg-r-label">0</span></label>
            <input type="range" id="bg-r-slider" min="0" max="255" value="0">
            <label style="color:#55efc4;">G: <span id="bg-g-label">0</span></label>
            <input type="range" id="bg-g-slider" min="0" max="255" value="0">
            <label style="color:#74b9ff;">B: <span id="bg-b-label">0</span></label>
            <input type="range" id="bg-b-slider" min="0" max="255" value="0">
            <div id="bg-color-preview" class="color-preview" style="background-color: rgb(0, 0, 0);"></div>
        </div>
    </div>

    <div id="history-container">
        <h2>ã‚¿ã‚¤ãƒ </h2>
        <ul id="history-list"></ul>
    </div>

    <div id="target-circle"></div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const targetCircle = document.getElementById('target-circle');
        const message = document.getElementById('message');
        const resultDisplay = document.getElementById('result');
        const historyList = document.getElementById('history-list');
        
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–‹é–‰ç”¨
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const closeBtn = document.getElementById('close-btn');
        const settingsContainer = document.getElementById('settings-container');

        // ä¸¸ã®è¨­å®šç”¨
        const sizeSlider = document.getElementById('size-slider');
        const sizeLabel = document.getElementById('size-label');
        const rSlider = document.getElementById('r-slider');
        const gSlider = document.getElementById('g-slider');
        const bSlider = document.getElementById('b-slider');
        const rLabel = document.getElementById('r-label');
        const gLabel = document.getElementById('g-label');
        const bLabel = document.getElementById('b-label');
        const colorPreview = document.getElementById('color-preview');

        // èƒŒæ™¯ã®è¨­å®šç”¨
        const bgRSlider = document.getElementById('bg-r-slider');
        const bgGSlider = document.getElementById('bg-g-slider');
        const bgBSlider = document.getElementById('bg-b-slider');
        const bgRLabel = document.getElementById('bg-r-label');
        const bgGLabel = document.getElementById('bg-g-label');
        const bgBLabel = document.getElementById('bg-b-label');
        const bgColorPreview = document.getElementById('bg-color-preview');

        const MAX_TRIALS = 5;
        let trialCount = 0;
        let reactionTimes = [];
        let startTime = 0;
        let timeoutId = null;
        let currentState = 'IDLE'; 

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        startBtn.addEventListener('click', startGame);
        document.addEventListener('pointerdown', handleScreenTap);

        // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®é–‹é–‰
        hamburgerBtn.addEventListener('click', () => {
            settingsContainer.classList.add('open');
        });
        closeBtn.addEventListener('click', () => {
            settingsContainer.classList.remove('open');
        });

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å¤‰æ›´æ¤œçŸ¥
        [sizeSlider, rSlider, gSlider, bSlider, bgRSlider, bgGSlider, bgBSlider].forEach(slider => {
            slider.addEventListener('input', updateSettings);
        });

        // --- è¨­å®šã®æ›´æ–°å‡¦ç† ---
        function updateSettings() {
            // ä¸¸ã®æ›´æ–°
            const size = sizeSlider.value;
            sizeLabel.textContent = size;
            targetCircle.style.width = `${size}vmin`;
            targetCircle.style.height = `${size}vmin`;

            const r = rSlider.value; const g = gSlider.value; const b = bSlider.value;
            rLabel.textContent = r; gLabel.textContent = g; bLabel.textContent = b;
            const newColor = `rgb(${r}, ${g}, ${b})`;
            colorPreview.style.backgroundColor = newColor;
            targetCircle.style.backgroundColor = newColor;

            // èƒŒæ™¯ã®æ›´æ–°
            const bgR = bgRSlider.value; const bgG = bgGSlider.value; const bgB = bgBSlider.value;
            bgRLabel.textContent = bgR; bgGLabel.textContent = bgG; bgBLabel.textContent = bgB;
            const newBgColor = `rgb(${bgR}, ${bgG}, ${bgB})`;
            bgColorPreview.style.backgroundColor = newBgColor;
            document.body.style.backgroundColor = newBgColor;
        }

        // --- ã‚²ãƒ¼ãƒ å‡¦ç† ---
        function startGame() {
            trialCount = 0;
            reactionTimes = [];
            startBtn.style.display = 'none';
            resultDisplay.style.display = 'none';
            
            // ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ã„ã¦ã„ãŸã‚‰é–‰ã˜ã‚‹
            settingsContainer.classList.remove('open');
            
            historyList.innerHTML = '';
            for(let i = 1; i <= MAX_TRIALS; i++) {
                historyList.innerHTML += `<li id="trial-${i}">${i}å›ç›®: --- ms</li>`;
            }
            nextTrial();
        }

        function nextTrial() {
            if (trialCount >= MAX_TRIALS) {
                showResult();
                return;
            }
            startCountdown();
        }

        function startCountdown() {
            currentState = 'WAITING';
            message.classList.remove('warning');
            message.innerHTML = `ç¬¬ ${trialCount + 1} å› / å…¨ ${MAX_TRIALS} å› : æº–å‚™...<br><span style="font-size:0.9rem; font-weight:normal;">(ç”»é¢ã®ã©ã“ã‚’ã‚¿ãƒƒãƒã—ã¦ã‚‚OK)</span>`;
            
            const randomDelay = Math.floor(Math.random() * 4000) + 3000;
            timeoutId = setTimeout(showCircle, randomDelay);
        }

        function showCircle() {
            if (currentState !== 'WAITING') return; 
            
            currentState = 'REACTING';
            message.textContent = 'ä»Šã ï¼ï¼';
            targetCircle.style.display = 'block';
            startTime = performance.now(); 
        }

        function handleScreenTap(e) {
            // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒœã‚¿ãƒ³ã€è¨­å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã¯ã‚²ãƒ¼ãƒ ã®ã‚¿ãƒƒãƒ—ã¨è¦‹ãªã•ãªã„
            if (e.target.id === 'start-btn' || 
                e.target.closest('#settings-container') || 
                e.target.id === 'hamburger-btn') {
                return;
            }

            if (currentState === 'WAITING') {
                clearTimeout(timeoutId);
                currentState = 'IDLE';
                message.classList.add('warning');
                message.textContent = 'æ—©ã™ãã¾ã™ï¼ã‚‚ã†ä¸€åº¦...';
                
                setTimeout(() => {
                    if (trialCount < MAX_TRIALS) {
                        startCountdown();
                    }
                }, 1500);

            } else if (currentState === 'REACTING') {
                const endTime = performance.now();
                const reactionTime = Math.round(endTime - startTime);
                reactionTimes.push(reactionTime);
                
                targetCircle.style.display = 'none';
                currentState = 'IDLE';
                
                const listItem = document.getElementById(`trial-${trialCount + 1}`);
                if(listItem) {
                    listItem.textContent = `${trialCount + 1}å›ç›®: ${reactionTime} ms`;
                }

                trialCount++;
                setTimeout(nextTrial, 500);
            }
        }

        function showResult() {
            currentState = 'IDLE';
            targetCircle.style.display = 'none';
            
            const sum = reactionTimes.reduce((a, b) => a + b, 0);
            const average = sum / MAX_TRIALS;
            
            message.classList.remove('warning');
            message.innerHTML = 'ãƒ†ã‚¹ãƒˆå®Œäº†ï¼';
            
            // çµæœã‚‚ä¸­å¤®ã«å‡ºã™
            resultDisplay.innerHTML = `å¹³å‡åå¿œé€Ÿåº¦<br><span class="score">${Math.round(average)}</span> ms`;
            resultDisplay.style.display = 'block';
            
            startBtn.textContent = 'ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤';
            startBtn.style.display = 'inline-block';
        }
    </script>
</body>
</html>
